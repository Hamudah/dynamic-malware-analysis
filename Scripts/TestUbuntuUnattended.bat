@echo off

REM Name of the virtual machines
set VM_NAME1=FTP_SERVER2

REM Name of the distros
set VM_OSTYPE1=Ubuntu22_LTS_64

REM Location of the virtual machine disk in MB
set VM_DISK1=D:/VM_HDD/%VM_NAME1%.vdi

REM VBoxManage Path
set VBOXMANAGE_EXECUTABLE="C:\Program Files\Oracle\VirtualBox\VBoxManage.exe"

REM Delete VM with same name if it exists, otherwise create new one
%VBOXMANAGE_EXECUTABLE% unregistervm %VM_NAME1% --delete
%VBOXMANAGE_EXECUTABLE% createvm --name %VM_NAME1% --register

REM define OS TYPE
%VBOXMANAGE_EXECUTABLE% modifyvm %VM_NAME1% --ostype %VM_OSTYPE1%

REM define vm specs
%VBOXMANAGE_EXECUTABLE% modifyvm %VM_NAME1% --cpus 4 --memory 4096 --vram 128

REM define network settings; Here internal network call MalwareAnalysis
%VBOXMANAGE_EXECUTABLE% modifyvm %VM_NAME1% --nic1 intnet --intnet1 MalwareAnalysis

REM Change graphic Controll, since standard is VboxVGA which flickers
%VBOXMANAGE_EXECUTABLE% modifyvm %VM_NAME1% --graphicscontroller vmsvga

REM create hdd and define path
%VBOXMANAGE_EXECUTABLE% createhd --filename %VM_DISK1% --size 32768
%VBOXMANAGE_EXECUTABLE% storagectl %VM_NAME1% --name "SATA Controller" --add sata --controller IntelAHCI
%VBOXMANAGE_EXECUTABLE% storageattach %VM_NAME1% --storagectl "SATA Controller" --port 0 --device 0 --type hdd --medium %VM_DISK1%

REM Attach ISO file
%VBOXMANAGE_EXECUTABLE% storageattach %VM_NAME1% --storagectl "SATA Controller" --port 1 --device 0 --type dvddrive --medium "D:\VM_ISO\ubuntu-22.04.1-desktop-amd64.iso"

REM Define Boot Order
%VBOXMANAGE_EXECUTABLE% modifyvm %VM_NAME1% --boot1 dvd --boot2 disk --boot3 none --boot4 none

REM Perform unattended installation
%VBOXMANAGE_EXECUTABLE% unattended install %VM_NAME1% --iso="D:\VM_ISO\ubuntu-22.04.1-desktop-amd64.iso" --start-vm=gui --user=hamud --password=hamud --full-user-name=hamud --install-additions --locale=en_US.UTF-8 --country=DE --time-zone=Europe/Berlin --hostname=hamud --install-to=<disk> --no-install-recommends --preseed="D:\BA\dynamic-malware-analysis\config_isos\preseed.cfg"

REM Start VM
REM %VBOXMANAGE_EXECUTABLE% startvm %VM_NAME1% --type gui
