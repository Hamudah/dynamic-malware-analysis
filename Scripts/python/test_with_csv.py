import csv
import subprocess
import threading
import time

csv_file = 'config_files/goodware_list.csv'
fixed_duration = 45

def execute_command(command, args):
    cmd = [command] + args
    print(f'Executing: {cmd}')
    process = subprocess.Popen(cmd, shell=False, text=True)

    def terminate_process():
        if process.poll() is None:
            print(f'Command will be terminated, 45 seconds have passed')
            process.kill()

    timer = threading.Timer(fixed_duration, terminate_process)
    timer.start()
    process.wait()
    timer.cancel()

    time.sleep(5)  # Add a 5-second sleep after a command has finished

with open(csv_file, 'r') as file:
    reader = csv.DictReader(file)
    for row in reader:
        command = row['command']
        args = row['args'].split()

        execute_command(command, args)

print('All commands executed.')
