#!/bin/bash

# take a snapshot of the Windows VM before executing the script
VBoxManage snapshot "Windows VM" take "Before Script"

# start the Windows VM in headless mode
VBoxManage startvm "Windows VM" --type headless

# wait for the Windows VM to boot
while ! VBoxManage guestcontrol "Windows VM" exec --image "C:\\Windows\\System32\\cmd.exe" --username user --password password --wait-stdout -- cmd /c "echo Windows VM booted"; do
    sleep 5
done

# execute the first executable on the Windows VM using SSH
ssh user@windows-vm "C:\\path\\to\\executable1.exe"

# power off the Windows VM
VBoxManage controlvm "Windows VM" poweroff

# revert to the snapshot taken earlier
VBoxManage snapshot "Windows VM" restore "Before Script"

# start the Windows VM in headless mode
VBoxManage startvm "Windows VM" --type headless

# wait for the Windows VM to boot
while ! VBoxManage guestcontrol "Windows VM" exec --image "C:\\Windows\\System32\\cmd.exe" --username user --password password --wait-stdout -- cmd /c "echo Windows VM booted"; do
    sleep 5
done

# execute the second executable on the Windows VM using SSH
ssh user@windows-vm "C:\\path\\to\\executable2.exe"
