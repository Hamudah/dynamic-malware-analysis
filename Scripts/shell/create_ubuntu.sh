#!/bin/bash

#Name of the virtual machine
VM_NAME="FTP_SERVER"

#Name of the distro
VM_OSTYPE="Ubuntu22_LTS_64"

#Location of the virtual machine disk in MB
VM_DISK="D:/VM_HDD/$VM_NAME.vdi" 

#VBoxManage Pfad
VBOXMANAGE_EXECUTABLE="/mnt/c/Program Files/Oracle/VirtualBox/VBoxManage.exe"

#Delete VM with same name if it exists, otherwise create new one
"$VBOXMANAGE_EXECUTABLE" unregistervm $VM_NAME --delete 
"$VBOXMANAGE_EXECUTABLE" createvm --name $VM_NAME --register

#define OS TYPE
"$VBOXMANAGE_EXECUTABLE" modifyvm $VM_NAME --ostype $VM_OSTYPE

#define vm specs
"$VBOXMANAGE_EXECUTABLE" modifyvm $VM_NAME --cpus 4 --memory 4096 --vram 128

#define network settings; Here internal network call MalwareAnalysis
"$VBOXMANAGE_EXECUTABLE" modifyvm $VM_NAME --nic1 intnet --intnet1 MalwareAnalysis

#Change graphic Controll, since standard is VboxVGA which flickers
"$VBOXMANAGE_EXECUTABLE" modifyvm $VM_NAME --graphicscontroller vmsvga

#create hdd and define path
"$VBOXMANAGE_EXECUTABLE" createhd --filename $VM_DISK --size 32768
"$VBOXMANAGE_EXECUTABLE" storagectl $VM_NAME --name "SATA Controller" --add sata --controller IntelAHCI
"$VBOXMANAGE_EXECUTABLE" storageattach $VM_NAME --storagectl "SATA Controller" --port 0 --device 0 --type hdd --medium $VM_DISK

#Attach ISO file
"$VBOXMANAGE_EXECUTABLE" storageattach $VM_NAME --storagectl "SATA Controller" --port 1 --device 0 --type dvddrive --medium "D:\VM_ISO\ubuntu-22.04.1-desktop-amd64.iso"

#Define Boot Order
"$VBOXMANAGE_EXECUTABLE" modifyvm $VM_NAME --boot1 dvd --boot2 disk --boot3 none --boot4 none

#Start VM
"$VBOXMANAGE_EXECUTABLE" startvm $VM_NAME --type headless

