#!/bin/bash

# Name of the virtual machine
VM_NAME="WindowsMalware"

# Name of the distro
VM_OSTYPE="Windows10_32"

# Location of the virtual machine disk in MB
VM_DISK="/Users/muhammed.adel/VirtualBox VMs/$VM_NAME.vdi"

# Delete VM with same name if it exists, otherwise create new one
VBoxManage unregistervm $VM_NAME --delete
VBoxManage createvm --name $VM_NAME --register

# Define OS type
VBoxManage modifyvm $VM_NAME --ostype $VM_OSTYPE

# Define VM specs
VBoxManage modifyvm $VM_NAME --cpus 2 --memory 4096 --vram 128

# Define network settings; here internal network called MalwareAnalysis
VBoxManage modifyvm $VM_NAME --nic1 intnet --intnet1 MalwareAnalysis

# Change graphics controller, since standard is VboxVGA which flickers
VBoxManage modifyvm $VM_NAME --graphicscontroller vmsvga

# Create HDD and define path
VBoxManage createhd --filename "$VM_DISK" --size 100000 --variant Standard
VBoxManage storagectl $VM_NAME --name "SATA Controller" --add sata --controller IntelAHCI
VBoxManage storageattach $VM_NAME --storagectl "SATA Controller" --port 0 --device 0 --type hdd --medium "$VM_DISK"

# Attach ISO file
VBoxManage storageattach $VM_NAME --storagectl "SATA Controller" --port 1 --device 0 --type dvddrive --medium "/Users/muhammed.adel/Downloads/Win10_22H2_German_x32.iso"

# Define boot order
VBoxManage modifyvm $VM_NAME --boot1 dvd --boot2 disk --boot3 none --boot4 none

# Start VM
VBoxManage startvm $VM_NAME --type headless
